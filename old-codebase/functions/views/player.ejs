<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <% if (success === true) {%>
  <title><%- data.username %>'s Bedwars Stats</title>
  <link rel="shortcut icon" href="https://crafatar.com/avatars/<%- data.uuid %>?size=32&overlay=true" type="image/x-icon" />
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      [...document.querySelectorAll(".change-time")].forEach((timeElem) => {
        let timeStr = timeElem.attributes.getNamedItem("datetime").value;
        // console.log(timeStr);
        timeElem.innerHTML = new Date(timeStr).toLocaleTimeString();
      });

      // document.body.style.backgroundImage = `linear-gradient(rgba(255,255,255,.2),rgba(255,255,255,.2)),url("/bgimg/${Math.floor(Math.random() * 15) + 1}.jpeg")`;

      var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
      var tooltipList = tooltipTriggerList.map(function(tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
      });
    });

    // /* prettier-ignore */ var data = JSON.parse('<%- 1 || JSON.stringify(data) %>')
    // console.log("%cHere is the data in JSON.", "font-size:1.5em;color:#42a7f5;font-weight:700;", data);

    //  /* prettier-ignore */ var raw_bwstats = JSON.parse('<%- 1 || JSON.stringify(data.raw_bwstats || null) %>')

    // console.log(raw_bwstats);
  </script>
  <meta name="og:description" content="<%- data.username %>' Stats: Level: <%- data.stats.levelFormatted %>, Wins: <%- data.stats.modes.total.wins %>, Coins: <%- data.stats.coinsFormatted %>" />
  <meta name="description" content="<%- data.username %> is a <%- mostPlayedMode %> Bedwars player with <%- data.stats.levelFormatted %> stars, <%- data.stats.modes.total.wins %> wins, and <%- data.stats.coinsFormatted %> coins." />
  <% } else {%>
  <title>Error - BW Stats</title>
  <% } %>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5/dist/css/bootstrap.min.css" />

  <!-- <script src="/custom-bs-collapse-v1.js"></script> -->
  <link rel="stylesheet" href="/css/main.css" />
  <style>
    body {
      background-image: linear-gradient(rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.2)),
        url("https://cdn.shivam.pro/app-static-data/images/bw-bg-compressed/<%- Math.floor(Math.random() * 14) + 1 %>.jpeg");
      background-position: center;
      background-repeat: no-repeat;
      background-size: cover;
      backdrop-filter: blur(3px);
      background-attachment: fixed;
    }

    .stats-container {
      backdrop-filter: blur(8px);
      background-color: rgba(255, 255, 255, 0.7);
    }

    .stats-table {
      border-color: #2125296f;
    }

    .challenge {
      margin-bottom: 0.25rem;
      width: max-content;
    }

    .challenge::after {
      content: "â“˜";
      color: #3d8fb8;
      margin-left: 0.25rem;
    }

    .challenges-list {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-around;
    }
  </style>
</head>

<body style="background-color: rgb(230, 230, 230); position: relative">
  <!-- <div class="sc-bg"></div> -->
  <nav class="navbar navbar-expand-sm navbar-dark bg-dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="/"><img src="/short_bed.png" alt="BW Stats" height="32" width="32" />&nbsp; Hypixel Bedwars Stats</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav-content" aria-controls="nav-content" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="nav-content">
        <ul class="navbar-nav me-auto">
          <li class="nav-item"><a class="nav-link" href="/">Stats</a></li>
          <li class="nav-item"><a class="nav-link" href="/about">About</a></li>
          <li class="nav-item"><a class="nav-link" href="/leaderboards">Leaderboards</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="stats-container mt-lg-4 mb-lg-5 container-lg pt-1 mb-0 pb-<%= success ? 5 : 2 %>">
    <% if (success === true) {%>
    <main class="main px-4">
      <h1 class="text-center my-3">
        <img src="https://crafatar.com/avatars/<%- data.uuid %>?overlay=true&size=16" alt="Player Icon" style="height: 3rem; image-rendering: pixelated" height="48" width="48" />
        <%- data.username %>'s Bedwars Stats
      </h1>
      <div class="main-content">
        <div class="leftbar pe-2" style="flex: 2">
          <!-- <%- include('ad1') %> -->
          <div class="player-img-box me-4 w-100">
            <img src="https://crafatar.com/renders/body/<%- data.uuid %>?overlay&scale=10" alt="Player Skin" class="player-img" onerror="(()=>{let src1='https://mc-heads.net/body/<%- data.uuid %>/right'; console.log(src1);if (this.src != src1) this.src = src1})()" />
          </div>
          <div class="alert alert-info no-mobile" role="alert">
            Tip! Share your <a href="https://bwstats.shivam.pro/user/<%= data.username %>" class="alert-link">stats link</a> with your friends and show them how amazing you are.
          </div>
          <!-- include ad1.ejs -->
        </div>
        <div style="width: 100%; flex: 6">
          <p>Level: <%- data.stats.levelFormatted %></p>
          <p>Coins: <%- data.stats.coinsFormatted %></p>
          <p>Final Kills/Deaths Ratio (FKDR): <%- data.stats.modes.total.fkdr %></p>
          <p>Beds Broken/Lost Ratio (BBLR): <%- data.stats.modes.total.bblr %></p>
          <div class="stats-table-container">
            <table class="table stats-table">
              <thead>
                <tr>
                  <th></th>
                  <% Object.entries(FRIENDLY_MODE_NAMES).forEach(function(sn) { -%>
                  <th><%- sn[1] -%></th>
                  <% }); -%>
                </tr>
              </thead>
              <tbody class="mb-2">
                <% (FRIENDLY_STAT_NAMES).forEach(function(sng) { -%> <% Object.keys(sng).forEach(function(sn) { -%>
                <tr>
                  <td><%- sng[sn] -%></td>
                  <% Object.keys(FRIENDLY_MODE_NAMES).forEach(function(mn) { -%>
                  <td><%- data.stats.modes[mn][sn].toLocaleString() -%></td>
                  <% }); _%>
                </tr>
                <% }); -%>
                <tr>
                  <td colspan="<%- Object.keys(FRIENDLY_MODE_NAMES).length + 1%>" class="divider"></td>
                </tr>
                <% }); -%>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div>
        <!-- Accordion -->
        <div class="accordion" id="accordionExample">
          <!-- Other Modes -->
          <div class="accordion-item">
            <h2 class="accordion-header" id="otherModesHeader">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#other-modes-acc" aria-expanded="false" aria-controls="other-modes-acc">
                Other Modes
              </button>
            </h2>
            <div id="other-modes-acc" class="accordion-collapse collapse" aria-labelledby="otherModesHeader" data-bs-parent="#accordionExample">
              <div class="accordion-body">
                <div class="stats-table-container">
                  <table class="table stats-table mb-0">
                    <thead>
                      <tr>
                        <th></th>
                        <% Object.entries(FRIENDLY_EXTRA_MODE_NAMES).forEach(function(sn) { -%>
                        <th><%- sn[1] -%></th>
                        <% }); -%>
                      </tr>
                    </thead>
                    <tbody class="mb-2">
                      <% (FRIENDLY_STAT_NAMES).forEach(function(sng) { -%> <% Object.keys(sng).forEach(function(sn) { -%>
                      <tr>
                        <td><%- sng[sn] -%></td>
                        <% Object.keys(FRIENDLY_EXTRA_MODE_NAMES).forEach(function(mn) { -%>
                        <td><%- data.stats.modes[mn] ? data.stats.modes[mn][sn].toLocaleString() : "Error" -%></td>
                        <% }); _%>
                      </tr>
                      <% }); -%>
                      <tr>
                        <td colspan="<%- Object.keys(FRIENDLY_EXTRA_MODE_NAMES).length + 1%>" class="divider"></td>
                      </tr>
                      <% }); -%>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <!-- Summary -->
          <div class="accordion-item">
            <h2 class="accordion-header" id="summaryHeader">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#summary-acc" aria-expanded="false" aria-controls="summary-acc">Summary</button>
            </h2>
            <div id="summary-acc" class="accordion-collapse collapse" aria-labelledby="summaryHeader" data-bs-parent="#accordionExample">
              <div class="accordion-body">
                <p><%- summary %></p>
              </div>
            </div>
          </div>
          <!-- Challenges -->
          <div class="accordion-item">
            <h2 class="accordion-header" id="challengesHeader">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#challenges-acc" aria-expanded="false" aria-controls="challenges-acc">
                Challenges
              </button>
            </h2>
            <div id="challenges-acc" class="accordion-collapse collapse" aria-labelledby="challengesHeader" data-bs-parent="#accordionExample">
              <div class="accordion-body">
                <div class="challenges-list">
                  <% if (data.stats.challenges.length > 0) { %>
                  <div>
                    <h3>Completed</h3>
                    <% data.stats.challenges.sort((a, b) => CHALLENGES[a].n - CHALLENGES[b].n).forEach(function(c) { const C = CHALLENGES[c]; %>
                    <p class="challenge" data-bs-toggle="tooltip" data-bs-html="true" data-bs-placement="right" title="<%= formatTitle(C) %>"><%= `${C.n+1}. ${C.name}` %></p>
                    <% }); -%>
                  </div>
                  <% } %> <% if (data.stats.challenges.length < Object.keys(CHALLENGES).length) { %>
                  <div>
                    <h3>Not Completed</h3>
                    <% Object.entries(CHALLENGES).filter(([k, v])=>!data.stats.challenges.includes(k)).sort(([k1, v1], [k2, v2]) => v1.n - v2.n).forEach(function([k, C]) { -%>
                    <p class="challenge" data-bs-toggle="tooltip" data-bs-html="true" data-bs-placement="right" title="<%= formatTitle(C) %>"><%= `${C.n+1}. ${C.name}` %></p>
                    <% }); -%>
                  </div>
                  <% } %>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="mt-3">
        <p class="text-center"><%- data.cached ? "Cached result" : "Result" %> from <time class="change-time" datetime="<%- data.time.toISOString() %>"><%- timeFormatted %></time></p>
      </div>
    </main>
    <% } else { %> <% if (error.length > 50) {%>
    <h1 class="text-center my-4">Error</h1>
    <p class="text-center">Please try again in 1 minute.</p>
    <p class="text-left my-4">
      <% error.toString().split("\n").forEach(function(x) { %> <%= x %>
      <br />
      <% }); %>
    </p>
    <% } else { %>
    <h1 class="text-center my-4"><%= error %></h1>
    <% } %> <% } %>
  </div>
  <footer class="navbar navbar-dark bg-dark text-light footer">
    <div class="container-fluid text-center">
      <p class="text-center w-100 my-3">This website was made by <a href="https://shivam.pro">Shivam</a>. Copyright &copy; 2021 shivam.pro. All rights reserved.</p>
    </div>
  </footer>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous" defer></script>

  <% if (!process.env.FUNCTIONS_EMULATOR) { %>
  <!-- Cloudflare Web Analytics -->
  <script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon='{"token": "fc6b8791fdb34ef18323c982296dda89"}'></script>
  <!-- End Cloudflare Web Analytics -->
  <% } %>
</body>

</html>